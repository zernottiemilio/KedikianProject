<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<div class="container-informes">
  <div class="header-section">
    <h1 class="titulo-principal">Informes y Reportes</h1>
  </div>

  <!-- Panel de resumen -->
  <div class="panel-resumen">
    <div class="tarjeta-resumen">
      <a [routerLink]="['/gestion-proyectos']" routerLinkActive="active" class="btn btn-sm">
      <h3 class="tarjeta-titulo">Proyectos Activos</h3>
      <p class="tarjeta-valor">{{resumen.proyectosActivos}}</p>
      </a>
    </div>
    <div class="tarjeta-resumen">
      <a [routerLink]="['/gestion-operarios']" routerLinkActive="active" class="btn btn-sm">
      <h3 class="tarjeta-titulo">Horas Registradas</h3>
      <p class="tarjeta-valor">{{resumen.horasTotales}}</p>
      </a>
    </div>
    <div class="tarjeta-resumen">
      <a [routerLink]="['/aridos']" routerLinkActive="active" class="btn btn-sm">
      <h3 class="tarjeta-titulo">Material Entregado</h3>
      <p class="tarjeta-valor">{{resumen.materialesEntregados}}</p>
      </a>
    </div>
    <div class="tarjeta-resumen">
      <h3 class="tarjeta-titulo">Gasto en Combustible</h3>
      <p class="tarjeta-valor">{{resumen.gastoCombustible}}</p>
    </div>
  </div>

  <!-- Filtros de informes -->
  <div class="panel-filtros">
    <div class="filtros-cabecera">
      <h2 class="filtros-titulo">Listado de Informes</h2>
      <div class="filtros-controles">
        <span class="filtros-etiqueta">Filtrar por:</span>
        <div class="filtros-selector">
          <select class="selector" [(ngModel)]="filtroTipo">
            <option value="todos">Todos los tipos</option>
            <option value="estadisticas">Estadísticas</option>
            <option value="reporte">Reportes</option>
          </select>
          <span class="material-icons icono-desplegable"><i class="fas fa-chevron-down"></i></span>
        </div>
      </div>
    </div>
  </div>

  <!-- Lista de informes -->
  <div class="panel-informes">
    <div *ngIf="cargando" class="cargando">
      <div class="spinner"></div>
      <span class="mensaje-cargando">Cargando informes...</span>
    </div>

    <div *ngIf="!cargando && informesFiltrados.length === 0" class="sin-resultados">
      <span class="material-icons" style="font-size: 48px; color: #dee2e6; margin-bottom: 1rem;">search_off</span>
      <p>No se encontraron informes con los filtros seleccionados.</p>
    </div>

    <ul *ngIf="!cargando && informesFiltrados.length > 0" class="lista-informes">
      <li *ngFor="let informe of informesFiltrados" class="item-informe">
        <div class="informe-contenido">
          <div class="informe-encabezado">
            <div class="informe-titulo-container">
              <div class="icono-tipo" [ngClass]="getClaseIcono(informe.tipo)">
                <span class="material-icons">
                  {{informe.tipo === 'gastos' ? 'pie_chart' : 'description'}}
                </span>
              </div>
              <div>
                <h3 class="informe-titulo">{{informe.titulo}}</h3>
                <div class="informe-descripcion">
                  <p>{{informe.descripcion}}</p>
                </div>
              </div>
            </div>
            <div class="informe-acciones">
              <span class="etiqueta-estatus" [ngClass]="getColorEstatus(informe.estatus)">
                {{getNombreEstatus(informe.estatus)}}
              </span>
              <button class="boton-descarga" (click)="descargarInforme(informe.id)" title="Descargar informe">
                <span class="fa-solid fa-download"></span>
              </button>
            </div>
          </div>
          <div class="informe-meta">
            <div class="informe-fecha">
              <span class="material-icons icono-fecha">fecha</span>
              {{informe.fecha}}
            </div>
          </div>
        </div>
      </li>
    </ul>
  </div>

  <!-- Botón para generar nuevo informe -->
  <div class="contenedor-boton-nuevo">
    <button class="boton-nuevo-informe" (click)="generarNuevoInforme()">
      <span class="material-icons"></span>
      Generar Nuevo Informe
    </button>
  </div>

  <!-- Modal para nuevo informe -->
  <div class="modal-overlay" *ngIf="mostrarModal" (click)="cerrarModal($event)">
    <div class="modal-contenido" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Generar Nuevo Informe</h2>
        <button class="btn-cerrar" (click)="cerrarModal($event)">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="modal-body">
        <form [formGroup]="informeForm" (ngSubmit)="guardarInforme()">
          <div class="form-group">
            <label for="titulo">Título del Informe</label>
            <input type="text" id="titulo" formControlName="titulo" class="form-control">
            <div class="error-message" *ngIf="informeForm.get('titulo')?.touched && informeForm.get('titulo')?.invalid">
              El título es requerido
            </div>
          </div>

          <div class="form-group">
            <label for="tipo">Tipo de Informe</label>
            <select id="tipo" formControlName="tipo" class="form-control">
              <option value="">Seleccione un tipo</option>
              <option value="gastos">Informe de Gastos</option>
              <option value="proyectos">Informe de Proyectos</option>
              <option value="horas">Informe de Horas Registradas</option>
              <option value="combustible">Informe de Gasto en Combustible</option>
            </select>
            <div class="error-message" *ngIf="informeForm.get('tipo')?.touched && informeForm.get('tipo')?.invalid">
              Seleccione un tipo de informe
            </div>
          </div>

          <div class="form-group">
            <label for="fechaInicio">Fecha Inicio</label>
            <input type="date" id="fechaInicio" formControlName="fechaInicio" class="form-control">
          </div>

          <div class="form-group">
            <label for="fechaFin">Fecha Fin</label>
            <input type="date" id="fechaFin" formControlName="fechaFin" class="form-control">
          </div>          <div class="form-group">
            <label for="valor">Valor</label>
            <div class="input-group">
              <input type="number" id="valor" formControlName="valor" class="form-control" min="0" step="0.01">
              <div class="unidad-valor">
                {{informeForm.get('tipo')?.value === 'materiales' ? 'm³' :
                  informeForm.get('tipo')?.value === 'horas' ? 'hrs' :
                  informeForm.get('tipo')?.value === 'combustible' ? '$' : ''}}
              </div>
            </div>
            <div class="error-message" *ngIf="informeForm.get('valor')?.touched && informeForm.get('valor')?.invalid">
              El valor debe ser mayor a 0
            </div>
          </div>

          <div class="form-group">
            <label for="descripcion">Descripción</label>
            <textarea id="descripcion" formControlName="descripcion" class="form-control" rows="3"
              placeholder="Agregue detalles adicionales del informe..."></textarea>
          </div>

          <div class="modal-footer">
            <button type="button" class="btn btn-secundario" (click)="cerrarModal($event)">Cancelar</button>            <button type="submit" class="btn btn-primario" [disabled]="informeForm.invalid || guardando">
              <i class="fas" [class.fa-file-export]="!guardando" [class.fa-spinner]="guardando" [class.fa-spin]="guardando"></i>
              {{guardando ? 'Generando...' : 'Generar Informe'}}
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
